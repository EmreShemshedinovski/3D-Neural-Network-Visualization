<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neural Network Visualization</title>
    <style>
        body { 
            background: #000; 
            color: #00f0ff; 
            font-family: 'Courier New', monospace; 
            text-align: center; 
            margin: 0; 
            padding: 20px;
            overflow: hidden;
            touch-action: none; 
        }
        canvas { 
            background: #000; 
            border: 2px solid #00f0ff; 
            box-shadow: 0 0 15px #0055ff; 
            margin: 10px auto; 
            display: block; 
            touch-action: none;
        }
        button { 
            background: #002244; 
            color: #00f0ff; 
            border: 1px solid #00f0ff; 
            padding: 15px 40px; 
            font-size: 18px; 
            font-weight: bold;
            border-radius: 5px; 
            box-shadow: 0 0 10px #0055ff;
            margin-top: 15px;
            cursor: pointer;
        }
        button:active { background: #00f0ff; color: #000; }
        #status { 
            margin-top: 20px; 
            font-size: 14px; 
            color: #aaa; 
            height: 40px;
        }
    </style>
</head>
<body>

    <h2 style="text-shadow: 0 0 10px #00f0ff;">DATA UPLOAD:</h2>
    
    <canvas id="paintCanvas" width="280" height="280"></canvas>
    
    <button id="sendButton">VISUALIZE</button>
    
    <div id="status">System Ready...</div>

    <script>
        const canvas = document.getElementById('paintCanvas');
        const ctx = canvas.getContext('2d');
        const status = document.getElementById('status');
        const btn = document.getElementById('sendButton');
        let drawing = false;

        // Position helper function
        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        // Input handling
        function startDrawing(e) {
            drawing = true;
            ctx.beginPath();
            const p = getPos(e);
            ctx.moveTo(p.x, p.y);
        }

        function moveDrawing(e) {
            if (!drawing) return;
            e.preventDefault(); 
            const p = getPos(e);
            ctx.lineWidth = 18;
            ctx.lineCap = 'round';
            ctx.strokeStyle = 'white';
            ctx.lineTo(p.x, p.y);
            ctx.stroke();
        }

        function stopDrawing() {
            drawing = false;
        }

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', moveDrawing);
        window.addEventListener('mouseup', stopDrawing);

        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', moveDrawing);
        window.addEventListener('touchend', stopDrawing);

        
        btn.addEventListener('click', async () => {
            status.innerText = "Processing Pixels...";
            status.style.color = "#00f0ff";

            try {
            
                const offscreen = document.createElement('canvas');
                offscreen.width = 28;
                offscreen.height = 28;
                const oCtx = offscreen.getContext('2d');
                oCtx.drawImage(canvas, 0, 0, 28, 28);

                
                const imgData = oCtx.getImageData(0, 0, 28, 28).data;
                const pixels = [];
                for (let i = 0; i < imgData.length; i += 4) {
                    pixels.push(imgData[i] / 255.0); 
                }

                status.innerText = "Connecting to Server...";

                
                const response = await fetch('https://phantastical-alessandro-butlerlike.ngrok-free.dev', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ pixels: pixels })
                });

                if (response.ok) {
                    status.innerText = " SUCCESS: DATA RECEIVED";
                    status.style.color = "#00ff00";
                    ctx.clearRect(0, 0, canvas.width, canvas.height); 
                } else {
                    status.innerText = "SERVER REJECTED: " + response.status;
                    status.style.color = "#ff3333";
                }

            } catch (err) {
                status.innerText = "CONNECTION FAILED: Check Firewall";
                status.style.color = "#ff3333";
                console.error(err);
            }
        });
    </script>
</body>
</html>
